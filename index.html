<!DOCTYPE html>
<meta charset="utf-8">
<title>Jetpack Reviewer Dashboard</title>
<script src="js/jquery.js"></script>
<script src="js/bugzilla.js"></script>
<script src="js/date-utils.js"></script>
<script>
var WEEK_MS = 1000 * 60 * 60 * 24 * 7;

function getReviewerInfo(email, numWeeksAgo, cb) {
  var requestsLeft = 0;
  var result = {
    reviewsPending: 0,
    reviewsDone: new Array(numWeeksAgo)
  };

  Bugzilla.ajax({
    url: "/count",
    data: {
      status: ["NEW", "UNCONFIRMED", "ASSIGNED", "REOPENED"],
      'flag.requestee': email,
      'product': 'Mozilla Labs',
      'component': 'Jetpack SDK',
      'changed_field': 'flag',
      'changed_after': timeAgo(WEEK_MS * numWeeksAgo)
    },
    success: function(data) {
      result.reviewsPending = data.data;
      if (--requestsLeft == 0)
        cb(result);
    }
  });
  requestsLeft += 1;

  function getReviewsForWeek(numWeeksAgo) {
    Bugzilla.ajax({
      url: "/count",
      data: {
        'flag.setter': email,
        'product': 'Mozilla Labs',
        'component': 'Jetpack SDK',
        'changed_field': 'flag',
        'changed_before': timeAgo(WEEK_MS * numWeeksAgo),
        'changed_after': timeAgo(WEEK_MS * (numWeeksAgo + 1))
      },
      success: function(data) {
        result.reviewsDone[numWeeksAgo] = data.data;
        if (--requestsLeft == 0)
          cb(result);
      }
    });
    requestsLeft += 1;
  }

  for (var i = 0; i < numWeeksAgo; i++)
    getReviewsForWeek(i);
}

$(window).ready(function() {
  getReviewerInfo('avarma@mozilla.com', 4, function(result) {
    console.log(JSON.stringify(result));
  });
});
</script>
<p>Hi.</p>
